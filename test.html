<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File System Access API Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto bg-white shadow-md rounded-lg p-6">
        <h1 class="text-2xl font-semibold text-blue-600 mb-4">File System Access API Test</h1>
        <p class="mb-4 text-gray-700">Click the button below to select a directory. The files and subdirectories within it will be listed below.</p>

        <button id="select-directory" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4">
            Select Directory
        </button>

        <div id="file-list-container" class="hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">Directory Contents:</h2>
            <ul id="file-list" class="border border-gray-200 rounded-md p-4">
                </ul>
        </div>
        <div id="error-message" class="text-red-500 mt-4 p-4 border border-red-300 rounded-md bg-red-50" style="display: none;">
            </div>
    </div>

    <script>
        const selectDirectoryButton = document.getElementById('select-directory');
        const fileListContainer = document.getElementById('file-list-container');
        const fileList = document.getElementById('file-list');
        const errorMessageElement = document.getElementById('error-message');

        function displayErrorMessage(message) {
            errorMessageElement.textContent = message;
            errorMessageElement.style.display = 'block';
            fileListContainer.style.display = 'none'; // Hide file list on error
        }

        function clearErrorMessage() {
            errorMessageElement.style.display = 'none';
            errorMessageElement.textContent = ''; // Clear message
        }

        selectDirectoryButton.addEventListener('click', async () => {
            clearErrorMessage();
            fileList.innerHTML = ''; // Clear any previous file list
            try {
                const directoryHandle = await window.showDirectoryPicker();
                fileListContainer.style.display = 'block'; // Show the file list container

                async function processDirectory(dirHandle, path = "") {
                    for await (const entry of dirHandle.values()) {
                        const li = document.createElement('li');
                        li.className = "py-2 border-b border-gray-200 last:border-0";
                        const itemPath = path ? `${path}/${entry.name}` : entry.name;

                        if (entry.kind === 'file') {
                            li.textContent = `File: ${itemPath}`;
                        } else if (entry.kind === 'directory') {
                            li.textContent = `Directory: ${itemPath}`;
                            const nestedUl = document.createElement('ul');
                            nestedUl.className = "ml-4";
                            li.appendChild(nestedUl);
                            fileList.appendChild(li); // Add the directory entry to the list *before* processing its contents
                            await processDirectory(entry, itemPath); // Recurse into the subdirectory
                        }
                         fileList.appendChild(li); // Add the file entry
                    }
                }
                await processDirectory(directoryHandle);
            } catch (err) {
                if (err.name === 'AbortError') {
                    // User canceled the directory selection, which is not really an error.
                    console.log('User canceled directory selection.');
                } else {
                    displayErrorMessage(`Error selecting directory: ${err.message}`);
                    console.error('Error selecting directory:', err);
                }
            }
        });
    </script>
</body>
</html>
